<p id="notice"><%= notice %></p>

<h1 class="center"><%=@course.course_number%>: <%=@course.title%></h1>
<h2 class="center"><%= @course.start_date%> - <%= @course.end_date%></h2>
<h2 class="center"><%=@course.status%></h2>

<h3 class="center">Course Materials</h3>
<p class="center"><%= @course.description%></p>

<h3 class="center">Course Instructors</h3>
<table class="table table-striped center col-md-4">

  <tbody>
  <% @course.enrollments.each do |enrollment| %>
      <% if !enrollment.deny %>
          <% user = User.find_by(id: enrollment.user_id)%>
          <% if user.is_instructor? %>
            <tr>
              <td><%=user.name%></td>
              <%if current_user.is_admin? && enrollment.multiple_instructors?%>
                <td><%= link_to 'Remove', enrollment, method: :delete, data: { confirm: 'Are you sure?' } %></td>
              <%end%>
            </tr>
          <%end%>
      <%end%>
  <%end%>
  </tbody>
</table>

<% if !current_user.is_student? %>
    <h3 class="center">Course Participants</h3>
    <table class="table table-striped table-hover">
      <thead>
      <tr>
        <th>Name</th>
        <th>Approval</th>
        <th>Grade</th>
      </tr>
      </thead>

      <tbody>
      <% @course.enrollments.each do |enrollment| %>
          <% if !enrollment.deny %>
              <% user = User.find_by(id: enrollment.user_id)%>
              <% if user.is_student? %>
              <tr>
                <td><%= link_to user.name, user %></td>
                <% if enrollment.approve %>
                    <td>Accepted</td>
                <% else %>
                    <td>
                      <%= form_for(enrollment) do |f| %>
                          <%= f.hidden_field :approve, :value => true %>
                          <%= f.hidden_field :deny, :value => false %>
                        <div class="actions" style="display: inline">
                          <%= f.submit :Approve %>
                        </div>
                      <%end%>
                      <%= form_for(enrollment) do |f| %>
                          <%= f.hidden_field :approve, :value => false %>
                          <%= f.hidden_field :deny, :value => true %>
                        <div class="actions" style="display: inline">
                          <%= f.submit :Deny %>
                        </div>
                      <%end%>
                    </td>
                <%end%>
                <% if enrollment.grade.blank? %>
                  <td><%= link_to 'Post Grade', edit_enrollment_path(enrollment), class: 'btn btn-info btn-sm'%></td>
                <% else %>
                  <td><%=enrollment.grade%></td>
                <%end%>
                <td><%= link_to 'Remove', enrollment, method: :delete, data: { confirm: 'Are you sure?' }, class: 'btn btn-danger btn-sm'%></td>
              </tr>
              <%end%>
          <%end%>
      <%end%>
      </tbody>
    </table>
<%end%>
<%= link_to 'Edit', edit_course_path(@course), class: 'btn btn-default pull-right' %> |
<%= link_to 'Back', courses_path, class: 'btn btn-default pull-right' %>
